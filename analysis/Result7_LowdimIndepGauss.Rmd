---
title: "Result7_LowdimIndepGauss"
output:
  workflowr::wflow_html:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

The experiment is based on the following simulation setting.

### Design setting

We sample the standard i.i.d. Gaussian measurement $X_{ij} \sim N(0,1)$ anda construct $X \in \mathbb{R}^p$ with $n = 1010$ and $p = 1000$.

### Signal setting

We consider the case reported by [False discoveries occur early on the Lasso path](https://projecteuclid.org/euclid.aos/1509436830).

The signal is $\beta_j = M$ for $j \in J_1$ and $\beta_j = 1/M$ for $j \in J_2$, where $J_1$ and $J_2$ are mutually exclusive random subset of $\{1,\cdots,p\}$ of size $10$ and $90$, respectively. Otherwise $\beta_j = 0$.

$M = 1000$ is very large positive constant, and we fix $\sigma^2 = 1$.

### PVE

We do not fix PVE, but it will be extremely large since $M$ is large compared to $\sigma^2 = 1$.

### Packages / Libraries

A list of packages we have loaded is collapsed. Please click "code" to see the list.

```{r library, message = FALSE}
library(Matrix); library(ggplot2); library(cowplot); library(susieR); library(BGLR);
library(glmnet); library(mr.ash.alpha); library(ncvreg); library(L0Learn); library(varbvs);
standardize = FALSE
source('code/method_wrapper.R')
source('code/sim_wrapper.R')
```

## Results

The result is summarized below.

```{r fig1, fig.height=7, fig.width=15}
res_df       = readRDS("results/subogdancandes.RDS")
method_list  = c("Mr.ASH","VarBVS","BayesB","Blasso","SuSiE","E-NET","Lasso","Ridge","SCAD","MCP","L0Learn",
                 "Mr.ASH.order","Mr.ASH.init")
method_level = c("Mr.ASH","Mr.ASH.order","Mr.ASH.init","E-NET","Lasso","Ridge",
                 "SCAD","MCP","L0Learn",
                 "VarBVS","BayesB","Blasso","SuSiE")
col          = gg_color_hue(13)[c(1,12,13,2:11)]
for (i in 1:2) {
res_df[[i]]$fit   = rep(method_list, each = 20)
res_df[[i]]$fit   = factor(res_df[[i]]$fit, levels =  method_level)
}

p1 = my.box2(res_df[[1]], "fit", "pred", cols = col) +
  theme(axis.line    = element_blank(),
        axis.text.x  = element_text(angle = 45,hjust = 1),
        legend.position = "none") +
  geom_hline(yintercept = mean(res_df[[1]]$pred[res_df[[1]]$fit == "Mr.ASH"]), col = gg_color_hue(11)[1],
             linetype = "dotted", size = 1.5) +
  scale_y_continuous(trans = "log10")
p2 = my.box2(res_df[[2]], "fit", "pred", cols = col) +
  theme(axis.line    = element_blank(),
        axis.text.x  = element_text(angle = 45,hjust = 1),
        legend.position = "none") +
  geom_hline(yintercept = mean(res_df[[2]]$pred[res_df[[2]]$fit == "Mr.ASH"]), col = gg_color_hue(11)[1],
             linetype = "dotted", size = 1.5) +
  scale_y_continuous(trans = "log10")
subtitle  = ggdraw() + draw_label("Scenario: SuBogdanCandes, n = 1010, p = 1000, pve = 0.5", fontface  = 'bold', size = 18) 
p1        = plot_grid(subtitle, p1, ncol = 1, rel_heights = c(0.06,0.95))
subtitle  = ggdraw() + draw_label("Scenario: SuBogdanCandes, n = 1010, p = 1000, pve = 0.5", fontface  = 'bold', size = 18) 
p2        = plot_grid(subtitle, p2, ncol = 1, rel_heights = c(0.06,0.95))
#p0        = ggplot() + geom_blank() + theme_cowplot() + theme(axis.line = element_blank())
fig_main  = plot_grid(p1,p2, nrow = 1, rel_widths = c(0.3,0.3,0.3,0.3))
title     = ggdraw() + draw_label("Prediction Error (log-scale)", fontface = 'bold', size = 20) 
fig       = plot_grid(title,fig_main, ncol = 1, rel_heights = c(0.1,0.95))
fig
```

```{r fig2, fig.height=7, fig.width=15}
p1 = my.box2(res_df[[1]], "fit", "time", cols = col) +
  theme(axis.line    = element_blank(),
        axis.text.x  = element_text(angle = 45,hjust = 1),
        legend.position = "none") +
  scale_y_continuous(trans = "log10")
p2 = my.box2(res_df[[2]], "fit", "time", cols = col) +
  theme(axis.line    = element_blank(),
        axis.text.x  = element_text(angle = 45,hjust = 1),
        legend.position = "none") +
  scale_y_continuous(trans = "log10")
subtitle  = ggdraw() + draw_label("Scenario: SuBogdanCandes, n = 1010, p = 1000, pve = 0.5", fontface  = 'bold', size = 18) 
p1        = plot_grid(subtitle, p1, ncol = 1, rel_heights = c(0.06,0.95))
subtitle  = ggdraw() + draw_label("Scenario: SuBogdanCandes, n = 1010, p = 1000, pve = 0.5", fontface  = 'bold', size = 18) 
p2        = plot_grid(subtitle, p2, ncol = 1, rel_heights = c(0.06,0.95))
#p0        = ggplot() + geom_blank() + theme_cowplot() + theme(axis.line = element_blank())
fig_main  = plot_grid(p1,p2, nrow = 1, rel_widths = c(0.3,0.3,0.3,0.3))
title     = ggdraw() + draw_label("Computation Time (log-scale)", fontface = 'bold', size = 20) 
fig       = plot_grid(title,fig_main, ncol = 1, rel_heights = c(0.1,0.95))
fig
```

```{r eval = FALSE}
tdat1        = list()
n            = 1010
p            = 1000
s            = 20
method_list  = c("varbvs","bayesb","blasso","susie","enet","lasso","ridge","scad2","mcp2","l0learn")
method_list2 = c("mr.ash", method_list, "mr.ash.order", "mr.ash.init","enet2","lasso2","ridge2")
method_num   = length(method_list2)
iter_num     = 20
pred         = matrix(0, iter_num, method_num); colnames(pred) = method_list2
time         = matrix(0, iter_num, method_num); colnames(time) = method_list2



for (iter in 1) {
for (i in 1:20) {
  set.seed(2010 + i)
  beta            = double(p)
  ind             = sample(p,s)
  M               = 5
  beta[ind]       = 1/M
  beta[ind[1:10]] = M
  data            = simulate_data(n, p, s = s, seed = i, beta = beta, sigma = 1)
 
  for (j in 1:length(method_list)) {
    fit.method    = get(paste("fit.",method_list[j],sep = ""))
    fit           = fit.method(data$X, data$y, data$X.test, data$y.test, seed = i)
    pred[i,j+1]   = fit$rsse / data$sigma / sqrt(n)
    time[i,j+1]   = fit$t
    if (method_list[j] == "lasso") {
      lasso.path.order = mr.ash.alpha:::path.order(fit$fit$glmnet.fit)
      lasso.beta       = as.vector(coef(fit$fit))[-1]
      lasso.time       = c(fit$t, fit$t2)
    }
    
    if (method_list[j] == "lasso") {
      pred[i,method_num - 1] = fit$rsse2 / data$sigma / sqrt(n)
    } else if (method_list[j] == "enet") {
      pred[i,method_num - 2] = fit$rsse2 / data$sigma / sqrt(n)
    } else if (method_list[j] == "ridge") {
      pred[i,method_num]     = fit$rsse2 / data$sigma / sqrt(n)
    }
  }
 
  fit         = fit.mr.ash(data$X, data$y, data$X.test, data$y.test, seed = i,
                           sa2 = (2^((0:19) / 2) - 1)^2)
  pred[i,1]   = fit$rsse / data$sigma / sqrt(n)
  time[i,1]   = fit$t
  
  fit         = fit.mr.ash2(data$X, data$y, data$X.test, data$y.test, seed = i,
                            update.order = lasso.path.order,
                            sa2 = (2^((0:19) / 2) - 1)^2)
  pred[i,j+2] = fit$rsse / data$sigma / sqrt(n)
  time[i,j+2] = fit$t + lasso.time[2]
  
  fit         = fit.mr.ash2(data$X, data$y, data$X.test, data$y.test, seed = i,
                            beta.init = lasso.beta,
                            sa2 = (2^((0:19) / 2) - 1)^2)
  pred[i,j+3] = fit$rsse / data$sigma / sqrt(n)
  time[i,j+3] = fit$t + lasso.time[1]
}
tdat1[[iter]] = data.frame(pred = c(pred), time = c(time), fit = rep(method_list2, each = 20))
}
```

## System Configuration

Click the below Session Info.
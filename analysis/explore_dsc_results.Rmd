---
title: "Explore DSC results"
author: "Youngseok Kim and Peter Carbonetto"
site: workflowr::wflow_site
output: workflowr::wflow_html
---

*Add text here.*

```{r knitr, echo=FALSE}
knitr::opts_chunk$set(comment = "#",results = "hold",collapse = TRUE,
                      fig.align = "center")
```

Load packages
-------------

Load a few packages used in the analysis below.

```{r load-pkgs, warning=FALSE, message=FALSE}
library(tools)
library(dscrutils)
library(ggplot2)
library(cowplot)
```

Import DSC results
------------------

Use function "dscquery" from the dscrutils package to extract the main
results of the DSC. (In practice, since this query can be slow when
the DSC contains a large number of results, it is better to call
"dscquery" once, save the data frame, then load it in R when it
needed.)

```{r query-dsc-results, eval=FALSE}
dsc <- dscquery("dsc/mr_ash",
                targets = c("simulate","simulate.s","simulate.sigma",
                            "fit","fit.lambda_est_method","fit.timing",
                            "score.err"))
dsc <- transform(dsc,
                 simulate              = factor(simulate),
                 simulate.s            = factor(simulate.s),
                 fit                   = factor(fit),
                 fit.lambda_est_method = factor(fit.lambda_est_method))
save(list = "dsc",file = "results/dsc.RData")
resaveRdaFiles("results/dsc.RData")
```

The "dsc" data frame should contain results for 1,920 separate runs
("pipelines").

```{r load-dsc-results}
load("results/dsc.RData")
nrow(dsc)
```

Inspect DSC results
-------------------

```{r, fig.height=4, fig.width=8}
pdat <- subset(dsc,
               simulate.s == 100 &
               is.element(fit,c("ridge","lasso","elastic_net")))
ggplot(pdat,aes(x = fit.lambda_est_method,y = score.err)) +
  geom_boxplot(color = "black",outlier.size = 1,width = 0.5) +
  facet_wrap(~fit,nrow = 1,scales = "free") +
  theme_cowplot(font_size = 12) +
  theme(axis.text.x = element_text(angle = 45,hjust = 1)) +
  labs(x = "")
```

Summarize the prediction error separately for each setting of "s", the
number of simulated effects.

```{r, fig.height=6, fig.width=8}
pdat <- subset(dsc,
               fit.lambda_est_method == "lambda.min" |
               is.na(fit.lambda_est_method))
ggplot(pdat,aes(x = fit,y = score.err,fill = fit)) +
  geom_boxplot(color = "black",outlier.size = 1,width = 0.85) +
  facet_wrap(~simulate.s,nrow = 2,scales = "free") +
  theme_cowplot(font_size = 12) +
  theme(axis.text.x = element_text(angle = 45,hjust = 1)) +
  labs(x = "method",y = "rsse")
```
